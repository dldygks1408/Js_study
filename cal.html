<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="./css/l18_calendar.css">
  <title>js calendar</title>
</head>

<body>
  <div id="container">
    <div class="bgModal">
      <h2>일정 추가</h2>
      <div class="content">
        <input type="text" size="50" placeholder="일정을 입력하세요.">
        <input type="text" size="50" placeholder="일정을 입력하세요.">
        <input type="text" size="50" placeholder="일정을 입력하세요.">
        <input type="text" size="50" placeholder="일정을 입력하세요.">
        <input type="text" size="50" placeholder="일정을 입력하세요."><br />
        <input id="valPrint" type="button" name="" value="확인">
        <input id="closeModal" type="button" name="" value="취소">
      </div>
    </div>
  </div>
  <h1>달력</h1>
  <h2>
    <button class="changeMonth" id="preMonth" type="button" value="2021-8"></button>
    <span id="toDate"></span>
    <button class="changeMonth" id="nextMonth" type="button" value="2021-10"></button>
  </h2>
  <form name="changeDate">
    <label> YEAR :
      <input type="number" name="" value="2030">
    </label>
    <label> MONTH :
      <select name="changeMonth">
        <option value="1">1월</option>
        <option value="2">2월</option>
        <option value="3">3월</option>
        <option value="4">4월</option>
        <option value="5">5월</option>
        <option value="6">6월</option>
        <option value="7">7월</option>
        <option value="8">8월</option>
        <option value="9">9월</option>
        <option value="10">10월</option>
        <option value="11">11월</option>
        <option value="12">12월</option>
      </select>
    </label>
  </form>
  <table id="calendarTable">
    <thead>
      <tr>
        <th>일</th>
        <th>월</th>
        <th>화</th>
        <th>수</th>
        <th>목</th>
        <th>금</th>
        <th>토</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</body>
<script>
  const tdList = document.querySelectorAll("#calendarTable td");
  for (td of tdList) {
    td.onmouseenter = (event) => {
      event.target.querySelector(".schedule").style.visibility = "visible";
    }
    td.addEventListener("mouseleave", function(event) {
      event.target.querySelector(".schedule").style.visibility = "hidden";
    });
    td.addEventListener('click', (e) => {
      const ulList = e.path[2].querySelector(".schedule");
      console.log(e.path);
      const ulliList = ulList.querySelectorAll('li');
      const inputText = document.querySelectorAll('input[type=text]');
      let textArray = [];
      document.getElementById('container').style.display = "block";
      console.log(e.path);
      document.querySelector('#valPrint').addEventListener('click', () => { //모달 확인 버튼 클릭시
        for (var i = 0; i < inputText.length; i++) { //input text 값 가져오기
          textArray.push(inputText[i].value); //가져온 값 배열 새로 만들어 추가
        }
        for (var i = 0; i < ulliList.length; i++) { //li 에 값 넣기
          ulliList[i].innerText = textArray[i]; //서로 같은 위치에 넣기
        }
        textArray.slice(inputText.length, 5); //배열 다시 삭제로 초기화
        console.log(textArray);
        document.getElementById('container').style.display = "none";
      });
      for (var i = 0; i < inputText.length; i++) { //input text 값 가져오기
        inputText[i].value = "";
      }
    });
  }
  //new Date().getMonth() 현재 달의 -1을 반환한다.(0~11)
  printCalendar(new Date().getMonth() + 1);
  //function(para,para="default") 꼭 마지막 파라미터에 기본값을 주세요
  function printCalendar(paraMonth, paraYear = (new Date().getFullYear())) {
    let dateMonth = paraMonth - 1; //Date()는 month 가 0~11까지다.
    //9월 마지막 일 구하기
    let lastDay = new Date(paraYear, dateMonth + 1, 0).getDate();
    //9월의 시작하는 요일 구하기
    let firstDay = new Date(paraYear, dateMonth, 1).getDay();
    //전달의 마지막날 구하기
    let lastMonth = new Date(paraYear, dateMonth, 0).getDate();

    //함수로 JSON 객체 선언하는 법
    function changeButton(para_year, para_month) {
      this.year = para_year;
      this.month = para_month; // this.key : 객체의 키를 만들겠다.
      this.text = `${this.year}년 ${this.month}월`;
      this.value = `${this.year} - ${this.month}`
    }
    //new changeButton(month,year);
    const nextButton = (paraMonth + 1 == 13)
                       ? new changeButton(paraYear + 1, 1)
                       : new changeButton(paraYear, paraMonth + 1);

    const preButton = (paraMonth - 1 == 0)
                      ? new changeButton(paraYear - 1, 12)
                      : new changeButton(paraYear, paraMonth - 1);
    const changeMonth = {
      next: nextButton,
      pre: preButton
    }

    document.getElementById("toDate").innerText = `${paraYear}. ${paraMonth}`;
    document.getElementById("nextMonth").innerText = `${paraYear+Math.floor(paraMonth/12)}. ${paraMonth%12+1}`;
    document.getElementById("nextMonth").value = `${paraYear+Math.floor(paraMonth/12)}-${paraMonth%12+1}`; //
    document.getElementById("preMonth").innerText = `${paraYear-(paraMonth==1 ? 1:0)}. ${paraMonth==1 ? 12:paraMonth-1}`;
    document.getElementById("preMonth").value = `${paraYear-(paraMonth==1 ? 1:0)}-${paraMonth==1 ? 12:paraMonth-1}`;
    //활성화된 해당 월 출력
    for (let i = firstDay, d = 1; i < lastDay + firstDay; i++) {
      tdList[i].querySelector(".day").innerText = d++;
      tdList[i].classList.add("active"); //활성화된 td 스타일 추가
      tdList[i].classList.remove("disabled"); //비활성화된 td 스타일 삭제
    }
    //비활성화된 전달의 출력
    for (let i = firstDay - 1; i >= 0; i--) {
      tdList[i].querySelector(".day").innerText = lastMonth--;
      tdList[i].classList.add("disabled"); //비활성화된 td 스타일 추가
      tdList[i].classList.remove("active"); //활성화된 td 스타일 삭제
    }
    //비활성화된 다음달 출력
    let nextMonth = firstDay + lastDay
    for (let i = nextMonth, num = 1; i <= tdList.length - 1; i++) {
      tdList[i].querySelector(".day").innerText = num++;
      tdList[i].classList.add("disabled"); //비활성화된 td 스타일 추가
      tdList[i].classList.remove("active"); //활성화된 td 스타일 삭제
    }
  }
  //button인 달 바꾸기만 onclick이벤트 재정의
  document.querySelectorAll(".changeMonth[type=button]").forEach((item) => {
    item.addEventListener("click", (event) => {
      let yearMonthArr = event.target.value.split("-")
      printCalendar(Number(yearMonthArr[1]), Number(yearMonthArr[0]));
    });
  });
  //modal 취소
  document.querySelector('#closeModal').addEventListener('click', () => {
    document.getElementById('container').style.display = "none";
  });
</script>

</html>
