<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="./css/l18_calendar.css">
  <title>js calendar</title>
</head>

<body>
  <h1>달력 만들기</h1>
  <h2>
    <button class="changeMonth" id="preMonth" type="button" value="2021-8"></button>
    <span id="toDate"></span>
    <button class="changeMonth" id="nextMonth" type="button" value="2021-10"></button>
  </h2>
  <article>
    <form class="insert_schedule" name="insertSchedule">
      <b id="printDay"></b>
      <label>
        <input type="time" name="registTime" value="09:00">
      </label>
      <label>
        <input type="text" name="registText" value="일어나라">
      </label>
      <button id="scbtn" type="button" name="regist"> 스케줄 추가</button>
    </form>
  </article>
  <hr>
  </article>
  <table id="calendarTable">
    <thead>
      <tr>
        <th>일</th>
        <th>월</th>
        <th>화</th>
        <th>수</th>
        <th>목</th>
        <th>금</th>
        <th>토</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
        <td>
          <div class="day_container">
            <h5 class="day"></h5>
            <ul class="schedule">
              <li></li>
              <li></li>
              <li></li>
              <li></li>
              <li></li>
            </ul>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</body>
<script>
  const d_2021_09 = {
    1: {
      610: '세수',
      730: '밥',
      800: '운전'
    },
    2: {
      610: '세수',
      730: '밥',
      800: '운전'
    }
  }
  console.log(d_2021_09[1][610]);
  const ulschedule = document.querySelectorAll("ul.schedule");
  const tdList = document.querySelectorAll("#calendarTable td");
  for (td of tdList) {
    td.onmouseenter = (event) => {
      event.target.querySelector(".schedule").style.visibility = "visible";
    }
    td.addEventListener("mouseleave", function(event) {
      event.target.querySelector(".schedule").style.visibility = "hidden";
    })
  }

  //new Date().getMonth() 현재 달의 -1을 반환한다.(0~11)
  printCalendar(new Date().getMonth() + 1);
  //function(para,para="default") 꼭 마지막 파라미터에 기본값을 주세요

  //new Date().getYear() = 2000-1900: 100, 2021-1900: 121
  function printCalendar(paraMonth, paraYear = (new Date().getYear() + 1900)) {
    let dateMonth = paraMonth - 1; //Date()는 month 가 0~11까지다.
    //9월 마지막 일 구하기
    let lastDay = new Date(paraYear, dateMonth + 1, 0).getDate();
    //9월의 시작하는 요일 구하기
    let firstDay = new Date(paraYear, dateMonth, 1).getDay();
    //전달의 마지막날 구하기
    let lastMonth = new Date(paraYear, dateMonth, 0).getDate();
    //////////////////////////////////////////////////////////////////////
    document.getElementById("toDate").innerText = `${paraYear}. ${paraMonth}`;
    document.getElementById("nextMonth").innerText = `${paraYear+Math.floor(paraMonth/12)}. ${paraMonth%12+1}`;
    document.getElementById("nextMonth").value = `${paraYear+Math.floor(paraMonth/12)}-${paraMonth%12+1}`; //
    document.getElementById("preMonth").innerText = `${paraYear-(paraMonth==1 ? 1:0)}. ${paraMonth==1 ? 12:paraMonth-1}`;
    document.getElementById("preMonth").value = `${paraYear-(paraMonth==1 ? 1:0)}-${paraMonth==1 ? 12:paraMonth-1}`;

    //document.getElementById("toDate").innerText=new Date(paraYear,dateMonth);

    //활성화된 해당 월 출력
    for (let i = firstDay, d = 1; i < lastDay + firstDay; i++) {
      tdList[i].querySelector(".day").innerText = d++;
      tdList[i].classList.add("active"); //활성화된 td 스타일 추가
      tdList[i].classList.remove("disabled"); //비활성화된 td 스타일 삭제
    }

    //비활성화된 전달의 출력
    for (let i = firstDay - 1; i >= 0; i--) {
      tdList[i].querySelector(".day").innerText = lastMonth--;
      tdList[i].classList.add("disabled"); //비활성화된 td 스타일 추가
      tdList[i].classList.remove("active"); //활성화된 td 스타일 삭제
    }
    //비활성화된 다음달 출력
    let nextMonth = firstDay + lastDay
    for (let i = nextMonth, num = 1; i <= tdList.length - 1; i++) {
      tdList[i].querySelector(".day").innerText = num++;
      tdList[i].classList.add("disabled"); //비활성화된 td 스타일 추가
      tdList[i].classList.remove("active"); //활성화된 td 스타일 삭제
    }
    printSchedule();
    function printSchedule(time) {
      for (td of tdList) {
        td.addEventListener('click', function() {
          const dayText = this.querySelector('.day').innerText;
          let clickul = ulschedule[Number(dayText) + Number(firstDay - 1)]

          document.querySelector('#printDay').innerText = `${dayText}일`;
          d_2021_09[dayText] = {
            610: '세수'
          };

          let li_html = "";
          for (key in d_2021_09) {
            li_html += `<li>`;
            li_html += `${JSON.stringify(d_2021_09[key][time])}`;
            li_html += `</li>`;
          }
          clickul.innerHTML = li_html;
        })
      }
    }

    document.forms.insertSchedule.regist.onclick = function(event){
      let registForm = event.target.form;
      let textVal = registForm.registText.value;
      let timeVal = registForm.registTime.value.split(':');
      let regist_time = Number(timeVal[0]*60) + Number(timeVal[1]);
      console.log(regist_time);
      d_2021_09 [regist_time] = textVal;
      printSchedule(regist_time);
    }

  }

  // const d_0913 =
  //   {
  //     430:"기상",
  //     450:"학원",
  //     1080:"퇴근",
  //     1170:"집 도착",
  //     1320:"취침"
  //   }
  // printSchedule();
  //
  // function printSchedule(){
  //   let li_html="";
  //   for(key in d_0913){
  //     li_html += `<li>`;
  //     li_html += `<b class='timeLeft'>`;
  //     li_html += `${ (Number.parseInt(key/60)+"").padStart(2,0)} : `;
  //     li_html += `${(Number.parseInt(key%60)+"").padStart(2,0)} `;
  //     li_html += `</b>`;
  //     li_html += `<span>`;
  //     li_html += `${d_0913[key]}`;
  //     li_html += `</span>`;
  //     li_html += `<button class='delete' value=${key} onclick='deleteScheldule(event)'>`;
  //     li_html += `🗑`;
  //     li_html += `</button>`;
  //     li_html += `</li>`;
  //     console.log(key);
  //   }
  //   document.querySelector('#memo ul.schedule').innerHTML = li_html;
  // }
  //
  // document.forms.insertSchedule.regist.onclick = function(event){
  //   let registForm = event.target.form;
  //   let textVal = registForm.registText.value;
  //   let timeVal = registForm.registTime.value.split(':');
  //   let regist_time = Number(timeVal[0]*60) + Number(timeVal[1]);
  //   d_0913 [regist_time] = textVal;
  //   printSchedule();
  // }

  //
  // //브라우저에 개체가 로드 될때 한번 재정의 한다.
  // function deleteScheldule(event){
  //   delete d_0913[Number(event.target.value)];
  //   printSchedule();
  // }

  //button인 달 바꾸기만 onclick이벤트 재정의
  document.querySelectorAll(".changeMonth[type=button]").forEach((item) => {
    //  item.onclick=function(){}
    item.addEventListener("click", (event) => {
      let yearMonthArr = event.target.value.split("-")
      printCalendar(Number(yearMonthArr[1]), Number(yearMonthArr[0]));
    });
  });
</script>

</html>
